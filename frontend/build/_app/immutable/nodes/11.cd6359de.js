import{S as Ke,i as Qe,s as Xe,C as Ze,y as E,a as h,k as j,q as V,z as D,c as S,l as q,m as z,r as B,h as a,n as x,A as T,b as c,G as ee,g as v,v as we,d as b,f as de,I as xe,B as I,J as G,w as F,ac as K,ad as Q}from"../chunks/index.607a4587.js";import{G as Se}from"../chunks/GreyText.545daa15.js";import{B as he,e as be,s as st}from"../chunks/strings.82d8c965.js";import{D as rt}from"../chunks/DangerButton.30216a4e.js";import{I as le}from"../chunks/InputSm.31ba033d.js";import{T as Ee,n as ke}from"../chunks/tasks.746ddd9e.js";import{I as De,S as it}from"../chunks/Service.3d0712ad.js";import{S as qe}from"../chunks/Select.43d10eda.js";function ut(l){let t,s,e,i,u;return t=new De({props:{icon:"material-symbols:delete-outline-sharp",color:"white"}}),{c(){E(t.$$.fragment),s=h(),e=j("span"),i=V("Delete"),this.h()},l(r){D(t.$$.fragment,r),s=S(r),e=q(r,"SPAN",{class:!0});var p=z(e);i=B(p,"Delete"),p.forEach(a),this.h()},h(){x(e,"class","ml-2")},m(r,p){T(t,r,p),c(r,s,p),c(r,e,p),ee(e,i),u=!0},p:G,i(r){u||(v(t.$$.fragment,r),u=!0)},o(r){b(t.$$.fragment,r),u=!1},d(r){I(t,r),r&&a(s),r&&a(e)}}}function ze(l){let t,s;return t=new Ee({props:{output:l[2]}}),{c(){E(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,i){T(t,e,i),s=!0},p(e,i){const u={};i[0]&4&&(u.output=e[2]),t.$set(u)},i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){b(t.$$.fragment,e),s=!1},d(e){I(t,e)}}}function ft(l){let t,s,e,i,u;return t=new De({props:{icon:"material-symbols:deployed-code",color:"white"}}),{c(){E(t.$$.fragment),s=h(),e=j("span"),i=V("Trigger Deploy"),this.h()},l(r){D(t.$$.fragment,r),s=S(r),e=q(r,"SPAN",{class:!0});var p=z(e);i=B(p,"Trigger Deploy"),p.forEach(a),this.h()},h(){x(e,"class","ml-2")},m(r,p){T(t,r,p),c(r,s,p),c(r,e,p),ee(e,i),u=!0},p:G,i(r){u||(v(t.$$.fragment,r),u=!0)},o(r){b(t.$$.fragment,r),u=!1},d(r){I(t,r),r&&a(s),r&&a(e)}}}function We(l){let t,s;return t=new Ee({props:{output:l[4]}}),{c(){E(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,i){T(t,e,i),s=!0},p(e,i){const u={};i[0]&16&&(u.output=e[4]),t.$set(u)},i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){b(t.$$.fragment,e),s=!1},d(e){I(t,e)}}}function at(l){let t,s,e,i,u;return t=new De({props:{icon:"ph:read-cv-logo-bold",color:"white"}}),{c(){E(t.$$.fragment),s=h(),e=j("span"),i=V("Get Service Logs"),this.h()},l(r){D(t.$$.fragment,r),s=S(r),e=q(r,"SPAN",{class:!0});var p=z(e);i=B(p,"Get Service Logs"),p.forEach(a),this.h()},h(){x(e,"class","ml-2")},m(r,p){T(t,r,p),c(r,s,p),c(r,e,p),ee(e,i),u=!0},p:G,i(r){u||(v(t.$$.fragment,r),u=!0)},o(r){b(t.$$.fragment,r),u=!1},d(r){I(t,r),r&&a(s),r&&a(e)}}}function Fe(l){let t,s;return t=new Ee({props:{output:l[6]}}),{c(){E(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,i){T(t,e,i),s=!0},p(e,i){const u={};i[0]&64&&(u.output=e[6]),t.$set(u)},i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){b(t.$$.fragment,e),s=!1},d(e){I(t,e)}}}function ot(l){return{c:G,l:G,m:G,p:G,i:G,o:G,d:G}}function mt(l){var Le,Oe;let t,s,e,i,u,r,p,A,_,y,U,P,O,C,g,d,w,k,f,o,N,X,R,W,ae,se,Y,re,M,oe,ie,H,me,ue,Z,fe,J,te;t=new it({props:{service:l[0]}});function _e(n){l[24](n)}let pe={id:"name",label:"Service Name",placeholder:"arcadia, ibl-backup etc.",minlength:1};l[7]!==void 0&&(pe.value=l[7]),e=new le({props:pe}),F.push(()=>K(e,"value",_e));function ge(n){l[25](n)}let $e={id:"command",label:"Command (must start with /usr/bin/)",placeholder:"E.g. /usr/bin/arcadia",minlength:3};l[8]!==void 0&&($e.value=l[8]),r=new le({props:$e}),F.push(()=>K(r,"value",ge));function ve(n){l[26](n)}let ce={id:"directory",label:"Directory",placeholder:"E.g. /root/arcadia",minlength:3};l[9]!==void 0&&(ce.value=l[9]),_=new le({props:ce}),F.push(()=>K(_,"value",ve));function $(n){l[27](n)}let L={name:"target",placeholder:"Choose Target",options:new Map((Oe=(Le=l[36])==null?void 0:Le.Targets)==null?void 0:Oe.map(vt))};l[10]!==void 0&&(L.value=l[10]),P=new qe({props:L}),F.push(()=>K(P,"value",$));function ne(n){l[28](n)}let Te={id:"description",label:"Description",placeholder:"E.g. Arcadia",minlength:5};l[11]!==void 0&&(Te.value=l[11]),g=new le({props:Te}),F.push(()=>K(g,"value",ne));function et(n){l[29](n)}let Ie={id:"after",label:"After",placeholder:"E.g. ibl-maint",minlength:1};l[12]!==void 0&&(Ie.value=l[12]),k=new le({props:Ie}),F.push(()=>K(k,"value",et));function tt(n){l[30](n)}let ye={name:"broken",placeholder:"Is the service broken/disabled?",options:new Map([["Yes, it is","0"],["No, its not","1"]])};l[13]!==void 0&&(ye.value=l[13]),N=new qe({props:ye}),F.push(()=>K(N,"value",tt)),Y=new Se({props:{$$slots:{default:[pt]},$$scope:{ctx:l}}});function nt(n){l[31](n)}let Ne={id:"user",label:"User",placeholder:"E.g. root",minlength:1};l[14]!==void 0&&(Ne.value=l[14]),M=new le({props:Ne}),F.push(()=>K(M,"value",nt));function lt(n){l[32](n)}let Pe={id:"group",label:"Group",placeholder:"E.g. root",minlength:1};return l[15]!==void 0&&(Pe.value=l[15]),H=new le({props:Pe}),F.push(()=>K(H,"value",lt)),J=new he({props:{onclick:l[33],$$slots:{default:[$t]},$$scope:{ctx:l}}}),{c(){E(t.$$.fragment),s=h(),E(e.$$.fragment),u=h(),E(r.$$.fragment),A=h(),E(_.$$.fragment),U=h(),E(P.$$.fragment),C=h(),E(g.$$.fragment),w=h(),E(k.$$.fragment),o=h(),E(N.$$.fragment),R=h(),W=j("h2"),ae=V("Service User"),se=h(),E(Y.$$.fragment),re=h(),E(M.$$.fragment),ie=h(),E(H.$$.fragment),ue=h(),Z=j("div"),fe=h(),E(J.$$.fragment),this.h()},l(n){D(t.$$.fragment,n),s=S(n),D(e.$$.fragment,n),u=S(n),D(r.$$.fragment,n),A=S(n),D(_.$$.fragment,n),U=S(n),D(P.$$.fragment,n),C=S(n),D(g.$$.fragment,n),w=S(n),D(k.$$.fragment,n),o=S(n),D(N.$$.fragment,n),R=S(n),W=q(n,"H2",{class:!0});var m=z(W);ae=B(m,"Service User"),m.forEach(a),se=S(n),D(Y.$$.fragment,n),re=S(n),D(M.$$.fragment,n),ie=S(n),D(H.$$.fragment,n),ue=S(n),Z=q(n,"DIV",{class:!0}),z(Z).forEach(a),fe=S(n),D(J.$$.fragment,n),this.h()},h(){x(W,"class","text-xl font-semibold mt-4"),x(Z,"class","mb-2")},m(n,m){T(t,n,m),c(n,s,m),T(e,n,m),c(n,u,m),T(r,n,m),c(n,A,m),T(_,n,m),c(n,U,m),T(P,n,m),c(n,C,m),T(g,n,m),c(n,w,m),T(k,n,m),c(n,o,m),T(N,n,m),c(n,R,m),c(n,W,m),ee(W,ae),c(n,se,m),T(Y,n,m),c(n,re,m),T(M,n,m),c(n,ie,m),T(H,n,m),c(n,ue,m),c(n,Z,m),c(n,fe,m),T(J,n,m),te=!0},p(n,m){const Ae={};m[0]&1&&(Ae.service=n[0]),t.$set(Ae);const Ce={};!i&&m[0]&128&&(i=!0,Ce.value=n[7],Q(()=>i=!1)),e.$set(Ce);const Ge={};!p&&m[0]&256&&(p=!0,Ge.value=n[8],Q(()=>p=!1)),r.$set(Ge);const Ve={};!y&&m[0]&512&&(y=!0,Ve.value=n[9],Q(()=>y=!1)),_.$set(Ve);const Be={};!O&&m[0]&1024&&(O=!0,Be.value=n[10],Q(()=>O=!1)),P.$set(Be);const Ue={};!d&&m[0]&2048&&(d=!0,Ue.value=n[11],Q(()=>d=!1)),g.$set(Ue);const Me={};!f&&m[0]&4096&&(f=!0,Me.value=n[12],Q(()=>f=!1)),k.$set(Me);const He={};!X&&m[0]&8192&&(X=!0,He.value=n[13],Q(()=>X=!1)),N.$set(He);const Je={};m[1]&64&&(Je.$$scope={dirty:m,ctx:n}),Y.$set(Je);const Re={};!oe&&m[0]&16384&&(oe=!0,Re.value=n[14],Q(()=>oe=!1)),M.$set(Re);const Ye={};!me&&m[0]&32768&&(me=!0,Ye.value=n[15],Q(()=>me=!1)),H.$set(Ye);const je={};m[1]&64&&(je.$$scope={dirty:m,ctx:n}),J.$set(je)},i(n){te||(v(t.$$.fragment,n),v(e.$$.fragment,n),v(r.$$.fragment,n),v(_.$$.fragment,n),v(P.$$.fragment,n),v(g.$$.fragment,n),v(k.$$.fragment,n),v(N.$$.fragment,n),v(Y.$$.fragment,n),v(M.$$.fragment,n),v(H.$$.fragment,n),v(J.$$.fragment,n),te=!0)},o(n){b(t.$$.fragment,n),b(e.$$.fragment,n),b(r.$$.fragment,n),b(_.$$.fragment,n),b(P.$$.fragment,n),b(g.$$.fragment,n),b(k.$$.fragment,n),b(N.$$.fragment,n),b(Y.$$.fragment,n),b(M.$$.fragment,n),b(H.$$.fragment,n),b(J.$$.fragment,n),te=!1},d(n){I(t,n),n&&a(s),I(e,n),n&&a(u),I(r,n),n&&a(A),I(_,n),n&&a(U),I(P,n),n&&a(C),I(g,n),n&&a(w),I(k,n),n&&a(o),I(N,n),n&&a(R),n&&a(W),n&&a(se),I(Y,n),n&&a(re),I(M,n),n&&a(ie),I(H,n),n&&a(ue),n&&a(Z),n&&a(fe),I(J,n)}}}function pt(l){let t;return{c(){t=V("Defaults to root if unset. Note that this could be a possible security risk to use the wrong user/group!")},l(s){t=B(s,"Defaults to root if unset. Note that this could be a possible security risk to use the wrong user/group!")},m(s,e){c(s,t,e)},d(s){s&&a(t)}}}function $t(l){let t;return{c(){t=V("Edit Service")},l(s){t=B(s,"Edit Service")},m(s,e){c(s,t,e)},d(s){s&&a(t)}}}function ct(l){let t,s;return t=new Se({props:{$$slots:{default:[_t]},$$scope:{ctx:l}}}),{c(){E(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,i){T(t,e,i),s=!0},p(e,i){const u={};i[1]&64&&(u.$$scope={dirty:i,ctx:e}),t.$set(u)},i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){b(t.$$.fragment,e),s=!1},d(e){I(t,e)}}}function _t(l){let t;return{c(){t=V("Loading metadata...")},l(s){t=B(s,"Loading metadata...")},m(s,e){c(s,t,e)},d(s){s&&a(t)}}}function gt(l){let t,s,e,i,u,r,p,A,_,y,U,P,O,C;t=new rt({props:{onclick:l[21],$$slots:{default:[ut]},$$scope:{ctx:l}}});let g=l[1]!=""&&ze(l);i=new he({props:{onclick:l[22],$$slots:{default:[ft]},$$scope:{ctx:l}}});let d=l[3]!=""&&We(l);p=new he({props:{onclick:l[23],$$slots:{default:[at]},$$scope:{ctx:l}}});let w=l[5]!=""&&Fe(l),k={ctx:l,current:null,token:null,hasCatch:!1,pending:ct,then:mt,catch:ot,value:36,blocks:[,,,]};return Ze(l[19](),k),{c(){E(t.$$.fragment),s=h(),g&&g.c(),e=h(),E(i.$$.fragment),u=h(),d&&d.c(),r=h(),E(p.$$.fragment),A=h(),w&&w.c(),_=h(),y=j("h2"),U=V("Service Info"),P=h(),O=j("div"),k.block.c(),this.h()},l(f){D(t.$$.fragment,f),s=S(f),g&&g.l(f),e=S(f),D(i.$$.fragment,f),u=S(f),d&&d.l(f),r=S(f),D(p.$$.fragment,f),A=S(f),w&&w.l(f),_=S(f),y=q(f,"H2",{class:!0});var o=z(y);U=B(o,"Service Info"),o.forEach(a),P=S(f),O=q(f,"DIV",{});var N=z(O);k.block.l(N),N.forEach(a),this.h()},h(){x(y,"class","font-semibold text-xl")},m(f,o){T(t,f,o),c(f,s,o),g&&g.m(f,o),c(f,e,o),T(i,f,o),c(f,u,o),d&&d.m(f,o),c(f,r,o),T(p,f,o),c(f,A,o),w&&w.m(f,o),c(f,_,o),c(f,y,o),ee(y,U),c(f,P,o),c(f,O,o),k.block.m(O,k.anchor=null),k.mount=()=>O,k.anchor=null,C=!0},p(f,o){l=f;const N={};o[1]&64&&(N.$$scope={dirty:o,ctx:l}),t.$set(N),l[1]!=""?g?(g.p(l,o),o[0]&2&&v(g,1)):(g=ze(l),g.c(),v(g,1),g.m(e.parentNode,e)):g&&(we(),b(g,1,1,()=>{g=null}),de());const X={};o[1]&64&&(X.$$scope={dirty:o,ctx:l}),i.$set(X),l[3]!=""?d?(d.p(l,o),o[0]&8&&v(d,1)):(d=We(l),d.c(),v(d,1),d.m(r.parentNode,r)):d&&(we(),b(d,1,1,()=>{d=null}),de());const R={};o[1]&64&&(R.$$scope={dirty:o,ctx:l}),p.$set(R),l[5]!=""?w?(w.p(l,o),o[0]&32&&v(w,1)):(w=Fe(l),w.c(),v(w,1),w.m(_.parentNode,_)):w&&(we(),b(w,1,1,()=>{w=null}),de()),xe(k,l,o)},i(f){C||(v(t.$$.fragment,f),v(g),v(i.$$.fragment,f),v(d),v(p.$$.fragment,f),v(w),v(k.block),C=!0)},o(f){b(t.$$.fragment,f),b(g),b(i.$$.fragment,f),b(d),b(p.$$.fragment,f),b(w);for(let o=0;o<3;o+=1){const N=k.blocks[o];b(N)}C=!1},d(f){I(t,f),f&&a(s),g&&g.d(f),f&&a(e),I(i,f),f&&a(u),d&&d.d(f),f&&a(r),I(p,f),f&&a(A),w&&w.d(f),f&&a(_),f&&a(y),f&&a(P),f&&a(O),k.block.d(),k.token=null,k=null}}}const vt=l=>[(l==null?void 0:l.Name)+" - "+(l==null?void 0:l.Description),l==null?void 0:l.Name];function bt(l,t,s){var J,te,_e,pe,ge,$e,ve,ce;let{service:e}=t,i="",u=[];const r=async()=>{if(window.prompt("Are you sure you want to delete this service? (YES to confirm))")!="YES")return;let L=await fetch("/api/systemd/deleteService",{method:"POST",body:JSON.stringify({name:e==null?void 0:e.ID})});if(!L.ok){let ne=await L.text();be(ne);return}s(1,i=await L.text()),ke(i,ne=>{s(2,u=ne)})};let p="",A=[];const _=async()=>{let $=await fetch(`/api/systemd/initDeploy?id=${e==null?void 0:e.ID}`,{method:"POST"});if(!$.ok){let L=await $.text();be(L);return}s(3,p=await $.text()),ke(p,L=>{s(4,A=L)})};let y="",U=[];const P=async()=>{let $=await fetch(`/api/systemd/getServiceLogs?id=${e==null?void 0:e.ID}`,{method:"POST"});if(!$.ok){let L=await $.text();be(L)}s(5,y=await $.text()),ke(y,L=>{s(6,U=L)})};let O=(e==null?void 0:e.ID)||"",C=((J=e==null?void 0:e.Service)==null?void 0:J.Command)||"",g=((te=e==null?void 0:e.Service)==null?void 0:te.Directory)||"",d=((_e=e==null?void 0:e.Service)==null?void 0:_e.Target)||"ibl-maint",w=((pe=e==null?void 0:e.Service)==null?void 0:pe.Description)||"",k=(ge=e==null?void 0:e.Service)==null?void 0:ge.After,f=($e=e==null?void 0:e.Service)!=null&&$e.Broken?"0":"1",o=((ve=e==null?void 0:e.Service)==null?void 0:ve.User)||"",N=((ce=e==null?void 0:e.Service)==null?void 0:ce.Group)||"";const X=async()=>{let $=await fetch("/api/systemd/getMeta",{method:"POST"});if(!$.ok){let ne=await $.text();throw new Error(ne)}return await $.json()},R=async()=>{let $=await fetch("/api/systemd/createService?update=true",{method:"POST",body:JSON.stringify({name:O,service:{cmd:C,dir:g,target:d,description:w,after:k,broken:f==="0",user:o,group:N}})});if(!$.ok){let L=await $.text();be(L);return}st("Service editted successfully!")},W=()=>r(),ae=()=>_(),se=()=>P();function Y($){O=$,s(7,O)}function re($){C=$,s(8,C)}function M($){g=$,s(9,g)}function oe($){d=$,s(10,d)}function ie($){w=$,s(11,w)}function H($){k=$,s(12,k)}function me($){f=$,s(13,f)}function ue($){o=$,s(14,o)}function Z($){N=$,s(15,N)}const fe=()=>R();return l.$$set=$=>{"service"in $&&s(0,e=$.service)},[e,i,u,p,A,y,U,O,C,g,d,w,k,f,o,N,r,_,P,X,R,W,ae,se,Y,re,M,oe,ie,H,me,ue,Z,fe]}class wt extends Ke{constructor(t){super(),Qe(this,t,bt,gt,Xe,{service:0},null,[-1,-1])}}function dt(l){let t,s=l[3]+"",e;return{c(){t=j("p"),e=V(s),this.h()},l(i){t=q(i,"P",{class:!0});var u=z(t);e=B(u,s),u.forEach(a),this.h()},h(){x(t,"class","text-red-500")},m(i,u){c(i,t,u),ee(t,e)},p:G,i:G,o:G,d(i){i&&a(t)}}}function kt(l){var A;let t,s,e=((A=l[2])==null?void 0:A.ID)+"",i,u,r,p;return r=new wt({props:{service:l[2]}}),{c(){t=j("h1"),s=V("Viewing "),i=V(e),u=h(),E(r.$$.fragment),this.h()},l(_){t=q(_,"H1",{class:!0});var y=z(t);s=B(y,"Viewing "),i=B(y,e),y.forEach(a),u=S(_),D(r.$$.fragment,_),this.h()},h(){x(t,"class","text-2xl font-semibold")},m(_,y){c(_,t,y),ee(t,s),ee(t,i),c(_,u,y),T(r,_,y),p=!0},p:G,i(_){p||(v(r.$$.fragment,_),p=!0)},o(_){b(r.$$.fragment,_),p=!1},d(_){_&&a(t),_&&a(u),I(r,_)}}}function ht(l){let t,s;return t=new Se({props:{$$slots:{default:[St]},$$scope:{ctx:l}}}),{c(){E(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,i){T(t,e,i),s=!0},p(e,i){const u={};i&16&&(u.$$scope={dirty:i,ctx:e}),t.$set(u)},i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){b(t.$$.fragment,e),s=!1},d(e){I(t,e)}}}function St(l){let t;return{c(){t=V("Loading metadata...")},l(s){t=B(s,"Loading metadata...")},m(s,e){c(s,t,e)},d(s){s&&a(t)}}}function Et(l){let t,s,e={ctx:l,current:null,token:null,hasCatch:!0,pending:ht,then:kt,catch:dt,value:2,error:3,blocks:[,,,]};return Ze(l[0](),e),{c(){t=j("div"),e.block.c()},l(i){t=q(i,"DIV",{});var u=z(t);e.block.l(u),u.forEach(a)},m(i,u){c(i,t,u),e.block.m(t,e.anchor=null),e.mount=()=>t,e.anchor=null,s=!0},p(i,[u]){l=i,xe(e,l,u)},i(i){s||(v(e.block),s=!0)},o(i){for(let u=0;u<3;u+=1){const r=e.blocks[u];b(r)}s=!1},d(i){i&&a(t),e.block.d(),e.token=null,e=null}}}function Dt(l){const t=()=>new URLSearchParams(window.location.search).get("id")||"";return[async()=>{if(!t())throw new Error("No service id provided");let e=await fetch("/api/systemd/getServiceList",{method:"POST"});if(!e.ok){let r=await e.text();throw new Error(r)}let u=(await e.json()).find(r=>(r==null?void 0:r.ID)==t());if(!u)throw new Error("Service not found");return u}]}class Ct extends Ke{constructor(t){super(),Qe(this,t,Dt,Et,Xe,{})}}export{Ct as component};
